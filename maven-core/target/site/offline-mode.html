<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src\site\apt/offline-mode.apt at 2020-09-07
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="John Casey" />
    <meta name="Date-Revision-yyyymmdd" content="20200907" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Maven Core &#x2013; Offline Mode Design</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script type="text/javascript" src="./js/apache-maven-fluido-1.7.min.js"></script>
    <!-- Google Analytics -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-140879-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="../../../" id="bannerLeft"><img src="../../../images/apache-maven-project.png"  alt="Maven Core"/></a></div>
        <div class="pull-right"><a href="../../../" id="bannerRight"><img src="../../../images/maven-logo-black-on-white.png"  alt=""/></a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
      <li class=""><a href="https://www.apache.org/" class="externalLink" title="Apache">Apache</a><span class="divider">/</span></li>
      <li class=""><a href="../../../index.html" title="Maven">Maven</a><span class="divider">/</span></li>
      <li class=""><a href="../../" title="Ref">Ref</a><span class="divider">/</span></li>
      <li class=""><a href="../" title="Maven 3.7.0-SNAPSHOT">Maven 3.7.0-SNAPSHOT</a><span class="divider">/</span></li>
      <li class=""><a href="index.html" title="Maven Core">Maven Core</a><span class="divider">/</span></li>
    <li class="active ">Offline Mode Design <a href="https://github.com/apache/maven/tree/master/maven-core/src\site\apt/offline-mode.apt"><img src="./images/accessories-text-editor.png" title="Edit" /></a></li>
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2020-09-07</li>
          <li id="projectVersion" class="pull-right">Version: 3.7.0-SNAPSHOT</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Overview</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="apidocs/index.html" title="JavaDocs"><span class="none"></span>JavaDocs</a></li>
    <li><a href="xref/index.html" title="Source Xref"><span class="none"></span>Source Xref</a></li>
      <li class="nav-header">Reference</li>
    <li><a href="lifecycles.html" title="Lifecycles"><span class="none"></span>Lifecycles</a></li>
    <li><a href="default-bindings.html" title="Plugin Bindings to Default Lifecycle"><span class="none"></span>Plugin Bindings to Default Lifecycle</a></li>
    <li><a href="artifact-handlers.html" title="Artifact Handlers"><span class="none"></span>Artifact Handlers</a></li>
    <li><a href="core-extensions.html" title="Core Extensions"><span class="none"></span>Core Extensions</a></li>
      <li class="nav-header">Parent Project</li>
    <li><a href="../index.html" title="Apache Maven"><span class="none"></span>Apache Maven</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
      <li class="nav-header">Maven Projects</li>
    <li><a href="../../../archetype/index.html" title="Archetype"><span class="none"></span>Archetype</a></li>
    <li><a href="../../../resolver/index.html" title="Artifact Resolver"><span class="none"></span>Artifact Resolver</a></li>
    <li><a href="../../../doxia/index.html" title="Doxia"><span class="none"></span>Doxia</a></li>
    <li><a href="../../../jxr/index.html" title="JXR"><span class="none"></span>JXR</a></li>
    <li><a href="../../current" title="Maven"><span class="none"></span>Maven</a></li>
    <li><a href="../../../pom/index.html" title="Parent POMs"><span class="none"></span>Parent POMs</a></li>
    <li><a href="../../../plugins/index.html" title="Plugins"><span class="none"></span>Plugins</a></li>
    <li><a href="../../../plugin-testing/index.html" title="Plugin Testing"><span class="none"></span>Plugin Testing</a></li>
    <li><a href="../../../plugin-tools/index.html" title="Plugin Tools"><span class="none"></span>Plugin Tools</a></li>
    <li><a href="../../../apache-resource-bundles/index.html" title="Resource Bundles"><span class="none"></span>Resource Bundles</a></li>
    <li><a href="../../../scm/index.html" title="SCM"><span class="none"></span>SCM</a></li>
    <li><a href="../../../shared/index.html" title="Shared Components"><span class="none"></span>Shared Components</a></li>
    <li><a href="../../../skins/index.html" title="Skins"><span class="none"></span>Skins</a></li>
    <li><a href="../../../surefire/index.html" title="Surefire"><span class="none"></span>Surefire</a></li>
    <li><a href="../../../wagon/index.html" title="Wagon"><span class="none"></span>Wagon</a></li>
      <li class="nav-header">ASF</li>
    <li><a href="https://www.apache.org/foundation/how-it-works.html" class="externalLink" title="How Apache Works"><span class="none"></span>How Apache Works</a></li>
    <li><a href="https://www.apache.org/foundation/" class="externalLink" title="Foundation"><span class="none"></span>Foundation</a></li>
    <li><a href="https://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsoring Apache"><span class="none"></span>Sponsoring Apache</a></li>
    <li><a href="https://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks"><span class="none"></span>Thanks</a></li>
</ul>
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="maven.apache.org/ref/3.7.0-SNAPSHOT/maven-core/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript">asyncJs( 'https://cse.google.com/brand?form=search-form' )</script>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
    <div id="twitter">
    <a href="https://twitter.com/ASFMavenProject" class="twitter-follow-button" data-show-count="false" data-align="left" data-size="medium" data-show-screen-name="true" data-lang="en">Follow ASFMavenProject</a>
    <script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<div class="section">
<h2><a name="Offline_Mode_Design"></a>Offline Mode Design</h2>
<div class="section">
<h3><a name="UPDATE:_18-April-2005"></a>UPDATE: 18-April-2005</h3>
<p>We cannot take the approach outlined below of detecting which remote repositories are &quot;really&quot; offline, since offline mode is more of a behavior, and this will lead to counter-intuitive results. A different feature may exist unimplemented, which is to detect when the network is down and provide better feedback for that case. However, when offline mode is declared, nothing earmarked as remote should be accessed, regardless of whether it is actually a physically local resource.</p>
<p>NOTE: One side-effect of this design change is that all offline-mode code can be isolated to maven-core, maven-plugin-descriptor, and [possibly] maven-artifact. Usage of maven-wagon will be determined by an offline-aware manager.</p></div>
<div class="section">
<h3><a name="Assumptions:_What_is_Offline.3F"></a>Assumptions: What is Offline?</h3>
<p>For the purposes of determining the areas sensitive to offline status, it is definitely useful to define what the offline state really means.</p>
<ol style="list-style-type: decimal">
<li>This is obvious, but the network/internet is unavailable.</li>
<li>Localhost (127.0.0.1) may also be unavailable if the whole network stack is offline.</li>
<li>&quot;Remote&quot; repositories referenced using the file:// protocol may be available. However, if that file:// url references a file-share, as in the case of an NFS or SMB mount, that will be unavailable.
<p>So, offline mode has several implications, some of which may not be altogether obvious:</p>
<ul>
<li>Localhost may be unavailable. Therefore, even locally installed server processes which work by conversing over a port may fail.</li>
<li>Not all &quot;remote&quot; repositories will fail. Specifically, if the remote repo uses the file:// protocol, and it doesn't refer to a shared filesystem, it will continue to be available.
<p>The question remaining is: Which level of offline mode will we support? It seems reasonable to assume that users will be able to tell when localhost is not active (in most cases, localhost should be available, even if the rest of the network is not). Therefore, let's concentrate on the state where no network <i>beyond localhost</i> exists, and leave the more extreme state to users to diagnose and correct as necessary.</p></li></ul></li></ol></div>
<div class="section">
<h3><a name="Why_is_Offline_Mode_Important.3F"></a>Why is Offline Mode Important?</h3>
<p>Offline mode is essential for breaking the requirement that m2 operate in a network-connected environment. It means legitimizing a development environment in which there is no network connection, and providing a robust m2 service offering in such circumstances. Introduction of offline mode allows m2 to anticipate the inevitable network failures that accompany being physically disconnected from the network, and adjust it's behavior accordingly.</p>
<p>It is more than simply understanding that m2 cannot go and check for the latest version of some snapshot artifact. If m2 is offline, SCM operations cannot succeed; no artifact downloads can take place, regardless of whether they are snapshot versions; artifact deployment cannot take place; certain types of tests cannot be setup, since the container used to run them cannot be reached or started.</p>
<p>All of these operations will produce their own unique errors in the absence of a coordinated offline strategy. In addition, efforts to unite these failing behaviors behind a consistent user interface is much, much more difficult if the system can't tell whether it has access to the network required by these operations.</p>
<p>Offline mode really means anticipating a lack of network connectivity, and as a result turning off certain services provided by m2 and providing a coherent way of predicting and reporting when network-related failures will take place. It means warning users that since the network is missing, certain features and operations will be unavailable, rather than simply waiting for those operations to fail, then trying to help users decipher the error messages they get as a result.</p></div>
<div class="section">
<h3><a name="Implications_for_Resolution"></a>Implications for Resolution</h3>
<div class="section">
<h4><a name="Dependency_Resolution"></a>Dependency Resolution</h4>
<p>This one is obvious...we only have access to the repositories using the file:// protocol and living on a truly local filesystem when offline.</p></div>
<div class="section">
<h4><a name="Plugin_Resolution"></a>Plugin Resolution</h4>
<p>This is similar to dependency resolution. Plugin repositories not using file:// or not residing on a local (not shared) filesystem will be unavailable.</p></div></div>
<div class="section">
<h3><a name="Implications_for_Mojo_Execution"></a>Implications for Mojo Execution</h3>
<div class="section">
<h4><a name="Deployment_mojos"></a>Deployment mojos</h4>
<p>The concept of deployment is dependent on the availability of a some remote repository. Just as above, if that repository is not using file:// (which is highly likely to be the case), or the repository is not on a local filesystem, deployment will fail when offline.</p></div>
<div class="section">
<h4><a name="Testing_mojos"></a>Testing mojos</h4>
<p>This can be a problem if the tests are more than simple unit tests; that is, if they require configuration of a server process, and subsequent testing in-container.</p>
<p>Since we're only going to concern ourselves with states where localhost is still active, we only need to worry about this case when the server container is <b>not</b> installed on localhost. This allows the popular pattern of starting a server container in-JVM, running tests against it, and shutting it down.</p></div>
<div class="section">
<h4><a name="SCM_mojos"></a>SCM mojos</h4>
<p>See below for discussion on SCM-related operations. Any mojo which carries out some analysis or other interaction with a SCM system will likely be unavailable when in offline mode.</p></div></div>
<div class="section">
<h3><a name="Implications_for_Subsystems"></a>Implications for Subsystems</h3>
<div class="section">
<h4><a name="Maven-Wagon"></a>Maven-Wagon</h4>
<p>Parts of Wagon will continue to function normally. These include:</p>
<ul>
<li>The file wagon, provided the referenced location is on a local filesystem.
<p>It is not possible to determine whether a file-based location will be available except on a case-by-case basis (or a root-url by root-url basis). We may want to move the offline sensitivity entirely to Maven-Artifact, below, so we can be smarter about testing filesystem-based repositories, etc.</p></li>
<li>If not otherwise specified, all other wagons are assumed to be remote-only, and are therefore sensitive to offline mode.</li></ul></div>
<div class="section">
<h4><a name="Maven-Artifact"></a>Maven-Artifact</h4>
<p>This is wholly dependent on Maven-Wagon, above.</p>
<p>We could possibly use a flag on a particular Wagon to see whether it supports offline mode, and then test to see if the file-based basedir for an artifact repository works...if it doesn't work, we can mark that repository offline...</p>
<p>OTOH, all offline-mode checks can probably be run from Wagon-based APIs.</p></div>
<div class="section">
<h4><a name="Maven-SCM"></a>Maven-SCM</h4>
<p>In all but trivial examples, SCM operations cannot complete without having access to the versioning server. Therefore, it is assumed that any SCM-related activity will be unavailable when m2 is in offline mode.</p></div>
<div class="section">
<h4><a name="Maven-Core"></a>Maven-Core</h4>
<p>We'll examine the different parts of maven-core on a case-by-case basis, below:</p>
<div class="section">
<h5><a name="DefaultLifecycleExecutor"></a>DefaultLifecycleExecutor</h5>
<p>When binding goals to the project's configured lifecycle, each mojo descriptor should declare whether it requires online/offline status. This value should be a java.lang.Boolean, so it can implement 3VL (three value logic: yes, no, don't-care). The requiresOnline field in the mojo descriptor has the following semantics:</p>
<dl>
<dt>true</dt>
<dd>Online status is required for this mojo to function correctly.</dd>
<dt>false</dt>
<dd><b>(Default)</b> Either status is acceptable for the mojo to execute. It doesn't care.
<p>The majority of mojos will leave the requiresOnline == false, since online/offline status will be irrelevant, provided they have access to their required artifacts and other classpath elements. In the case of required artifacts and other classpath elements, this is assumed by the mojo API to be in a correct state, and will be handled by the Wagon modifications.</p></dd></dl></div></div></div>
<div class="section">
<h3><a name="Implementation_Notes"></a>Implementation Notes</h3>
<div class="section">
<h4><a name="Accessibility_of_offline_status"></a>Accessibility of offline status</h4>
<p>Offline status should be indicated in the MavenSettings instance, since it can conceivably be set from either the settings.xml or the command-line.</p>
<p>In the event the '-o' switch is the impetus for setting offline mode, this should result in modification of the active profile in the MavenSettings instance, just as definition of the active profile from the command-line should result in similar modification. This object is not meant to be static within the build process, but rather to be setup as an aggregation of all settings-related information passed into the system.</p></div>
<div class="section">
<h4><a name="Control_over_downloads"></a>Control over downloads</h4>
<p>Find the control point for m2 using maven-wagon. At this point, inject a offline status parameter which is used when retrieving the specific Wagon.</p>
<p>If <tt>offline == true</tt>:</p>
<ul>
<li>If the wagon is not bound to &quot;file://&quot;, then ignore the request and print a debug message.</li>
<li>If the wagon is bound to &quot;file://&quot; then:
<p>Retrieve the file or base-url file to be &quot;downloaded&quot;.</p>
<ul>
<li>If the file (or more usefully, the base-url file) exists, proceed.</li>
<li>If the file (or base-url file) doesn't exist, assume that this location is part of a file-share. Ignore the request and print a debug message as above.</li></ul></li></ul></div>
<div class="section">
<h4><a name="Control_over_mojos_in_the_lifecycle"></a>Control over mojos in the lifecycle</h4>
<p>When binding a mojo to the project's lifecycle instance, check the mojo descriptor's requiredConnectivity field.</p>
<ul>
<li>If <tt>(offline == true) &amp;&amp; (requiresOnline != true)</tt>, bind the mojo to the lifecycle.
<p>In this case, the client is <b>offline</b>, and the mojo does not require online status.</p></li>
<li>If <tt>(offline == false) &amp;&amp; (requiresOnline == true)</tt>, bind the mojo to the lifecycle.
<p>In this case, the client is <b>online</b>, and the mojo either requires <b>online</b> status, or else doesn't care.</p></li>
<li>Otherwise, don't bind the mojo. Log a debug message to indicate that it is sensitive the the online state of the application, and that this state is currently wrong for execution.
<p><b>NOTE:</b> Do we want to fail when we cannot bind a mojo to the lifecycle because of offline/online status? That would probably indicate that the user was trying to do something they cannot succeed at for now...so we probably should throw an exception in this case.</p></li></ul></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2001&#x2013;2020
<a href="https://www.apache.org/">The Apache Software Foundation</a>.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
