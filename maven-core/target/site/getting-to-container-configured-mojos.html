<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src\site\apt/getting-to-container-configured-mojos.apt at 2020-09-07
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="John Casey" />
    <meta name="Date-Revision-yyyymmdd" content="20200907" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Maven Core &#x2013; Getting to Plexus-configured Mojos</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script type="text/javascript" src="./js/apache-maven-fluido-1.7.min.js"></script>
    <!-- Google Analytics -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-140879-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="../../../" id="bannerLeft"><img src="../../../images/apache-maven-project.png"  alt="Maven Core"/></a></div>
        <div class="pull-right"><a href="../../../" id="bannerRight"><img src="../../../images/maven-logo-black-on-white.png"  alt=""/></a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
      <li class=""><a href="https://www.apache.org/" class="externalLink" title="Apache">Apache</a><span class="divider">/</span></li>
      <li class=""><a href="../../../index.html" title="Maven">Maven</a><span class="divider">/</span></li>
      <li class=""><a href="../../" title="Ref">Ref</a><span class="divider">/</span></li>
      <li class=""><a href="../" title="Maven 3.7.0-SNAPSHOT">Maven 3.7.0-SNAPSHOT</a><span class="divider">/</span></li>
      <li class=""><a href="index.html" title="Maven Core">Maven Core</a><span class="divider">/</span></li>
    <li class="active ">Getting to Plexus-configured Mojos <a href="https://github.com/apache/maven/tree/master/maven-core/src\site\apt/getting-to-container-configured-mojos.apt"><img src="./images/accessories-text-editor.png" title="Edit" /></a></li>
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2020-09-07</li>
          <li id="projectVersion" class="pull-right">Version: 3.7.0-SNAPSHOT</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Overview</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="apidocs/index.html" title="JavaDocs"><span class="none"></span>JavaDocs</a></li>
    <li><a href="xref/index.html" title="Source Xref"><span class="none"></span>Source Xref</a></li>
      <li class="nav-header">Reference</li>
    <li><a href="lifecycles.html" title="Lifecycles"><span class="none"></span>Lifecycles</a></li>
    <li><a href="default-bindings.html" title="Plugin Bindings to Default Lifecycle"><span class="none"></span>Plugin Bindings to Default Lifecycle</a></li>
    <li><a href="artifact-handlers.html" title="Artifact Handlers"><span class="none"></span>Artifact Handlers</a></li>
    <li><a href="core-extensions.html" title="Core Extensions"><span class="none"></span>Core Extensions</a></li>
      <li class="nav-header">Parent Project</li>
    <li><a href="../index.html" title="Apache Maven"><span class="none"></span>Apache Maven</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
      <li class="nav-header">Maven Projects</li>
    <li><a href="../../../archetype/index.html" title="Archetype"><span class="none"></span>Archetype</a></li>
    <li><a href="../../../resolver/index.html" title="Artifact Resolver"><span class="none"></span>Artifact Resolver</a></li>
    <li><a href="../../../doxia/index.html" title="Doxia"><span class="none"></span>Doxia</a></li>
    <li><a href="../../../jxr/index.html" title="JXR"><span class="none"></span>JXR</a></li>
    <li><a href="../../current" title="Maven"><span class="none"></span>Maven</a></li>
    <li><a href="../../../pom/index.html" title="Parent POMs"><span class="none"></span>Parent POMs</a></li>
    <li><a href="../../../plugins/index.html" title="Plugins"><span class="none"></span>Plugins</a></li>
    <li><a href="../../../plugin-testing/index.html" title="Plugin Testing"><span class="none"></span>Plugin Testing</a></li>
    <li><a href="../../../plugin-tools/index.html" title="Plugin Tools"><span class="none"></span>Plugin Tools</a></li>
    <li><a href="../../../apache-resource-bundles/index.html" title="Resource Bundles"><span class="none"></span>Resource Bundles</a></li>
    <li><a href="../../../scm/index.html" title="SCM"><span class="none"></span>SCM</a></li>
    <li><a href="../../../shared/index.html" title="Shared Components"><span class="none"></span>Shared Components</a></li>
    <li><a href="../../../skins/index.html" title="Skins"><span class="none"></span>Skins</a></li>
    <li><a href="../../../surefire/index.html" title="Surefire"><span class="none"></span>Surefire</a></li>
    <li><a href="../../../wagon/index.html" title="Wagon"><span class="none"></span>Wagon</a></li>
      <li class="nav-header">ASF</li>
    <li><a href="https://www.apache.org/foundation/how-it-works.html" class="externalLink" title="How Apache Works"><span class="none"></span>How Apache Works</a></li>
    <li><a href="https://www.apache.org/foundation/" class="externalLink" title="Foundation"><span class="none"></span>Foundation</a></li>
    <li><a href="https://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsoring Apache"><span class="none"></span>Sponsoring Apache</a></li>
    <li><a href="https://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks"><span class="none"></span>Thanks</a></li>
</ul>
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="maven.apache.org/ref/3.7.0-SNAPSHOT/maven-core/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript">asyncJs( 'https://cse.google.com/brand?form=search-form' )</script>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
    <div id="twitter">
    <a href="https://twitter.com/ASFMavenProject" class="twitter-follow-button" data-show-count="false" data-align="left" data-size="medium" data-show-screen-name="true" data-lang="en">Follow ASFMavenProject</a>
    <script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<div class="section">
<h2><a name="Abstract"></a>Abstract</h2>
<p>We're moving toward integrating mojos as first-class plexus components, while at the same time avoiding introducing required plexus dependencies into the mojo development model.</p>
<p>In order to really achieve this, we need mojo configurations (which are provided both in terms of static expressions that are just looked up, and in terms of user-provided configuration from system properties or the POM). If these mojos are to be first-class components, the configuration from these various sources must be consolidated and injected using the container.</p>
<p>Currently, mojo configuration is done externally to the container, in the DefaultPluginManager in the maven-core API. In order to get from here to there, we need to do several things to add capability to the default configuration of plexus. This document will detail those changes.</p></div>
<div class="section">
<h2><a name="Container_Enhancements"></a>Container Enhancements</h2>
<div class="section">
<h3><a name="ExpressionEvaluator"></a>ExpressionEvaluator</h3>
<p>Currently, the expression evaluator used to resolve configuration values is the DefaultExpressionEvaluator, which is a local variable within the implementation of the BasicComponentConfigurator. This ExpressionEvaluator simply returns the expression itself as the resolved value, which adds very little value to the container. Things like $<a name="project.build.resources">project.build.resources</a> are not resolved, and result in a type mismatch for the member injection.</p>
<p>We need a replacement for DefaultExpressionEvaluator that is capable of traversing an object graph and extracting Object values, not just Strings.</p></div>
<div class="section">
<h3><a name="ComponentConfigurator"></a>ComponentConfigurator</h3>
<p>Currently, the container uses BasicComponentConfigurator, to configure components. This wouldn't be a problem, except for the local instance of DefaultExpressionEvaluator used within. See the above discussion for more on why this evaluator is bad. We need to provide either an alternative implementation under a different roleHint, or else replace the BasicComponentConfigurator.</p></div>
<div class="section">
<h3><a name="Other"></a>Other</h3>
<p>We may need to define a new lifecycle/phase to contextualize a mojo right before it's used, and reset it's state afterward. Up to now, the approach of most plexus components has been to avoid instance state like the plague. With the current parameter passing model of mojos, this will not be possible, particularly when we move mojos to a singleton instantiation model, and then run a reactorized project...the successive calls may leave behind configuration artifacts from invocation to invocation.</p></div></div>
<div class="section">
<h2><a name="Maven_Modifications"></a>Maven Modifications</h2>
<div class="section">
<h3><a name="DefaultPluginManager"></a>DefaultPluginManager</h3>
<p>s/getMojoConfiguration()/getConfiguration()/g</p>
<p>That should re-enable usage of mojo configuration. Ideally, we won't need any of the code that references this method, since the container should provide some way of recontextualizing the mojo, and all we would need to do is inject POM configuration via the lookup method or something.</p></div>
<div class="section">
<h3><a name="PluginDescriptorBuilder"></a>PluginDescriptorBuilder</h3>
<p>s/getMojoConfiguration()/getConfiguration()/g</p>
<p>That should be all there is to it.</p></div>
<div class="section">
<h3><a name="MojoDescriptor"></a>MojoDescriptor</h3>
<p>Remove set/getMojoConfiguration(..), as it will become obsolete.</p></div>
<div class="section">
<h3><a name="MavenSession"></a>MavenSession</h3>
<p>We may need to enable the context injection here, since this will be instantiated per-project. If we always inject the same context parameters, and are careful to inject nulls where things are missing, we should be able to minimize reconfiguration artifacts injected from basic parameters.</p></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2001&#x2013;2020
<a href="https://www.apache.org/">The Apache Software Foundation</a>.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
